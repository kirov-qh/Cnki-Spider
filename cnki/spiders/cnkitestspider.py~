from scrapy.spiders import Spider
from scrapy.http import Request
from scrapy.selector import Selector
from cnki.items import CnkiItem

class CnkiTestSpider(Spider):
	'Here start the test spider.'
	
	name = "cnkispider"
	
	#To slowdown the speed of the spider.
	download_delay = 1
	allowed_domains = ["search.cnki.net"]
	start_urls = [
		"http://search.cnki.net/search.aspx?q=%E6%A3%AE%E6%9E%97%E8%99%AB%E5%AE%B3"
	]
	
	def parse(self, response):
		sel = Selector(response)
		
		items = []
		#Get the titles and URLs of current page.
		sites = sel.xpath('//*[@class="wz_content"]/h3')
		
		for site in sites:
			item = CnkiItem()
			item['title'] = site.xpath('a[1]/text()').extract()
			item['url'] = site.xpath('a[1]/@href').extract()
			#items.append(item)
			yield item
		
		
		#Get the URL of next page.
		urls = sel.xpath('//*[@id="page"]/a[10]/@href').extract()
		for url in urls:
			url = "http://search.cnki.net/" + url
			yield Request(url, callback = self.parse)
		
#		return items
			
			
